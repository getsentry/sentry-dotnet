@echo off
setlocal

pushd %~dp0

where xharness >nul 2>nul
if %ERRORLEVEL% NEQ 0 dotnet tool install Microsoft.DotNet.XHarness.CLI --global --version "1.*-*"

dotnet build -f net6.0-android ..\test\Sentry.Maui.Device.TestApp
if %ERRORLEVEL% NEQ 0 goto end

if exist ..\test_output rmdir /q /s ..\test_output
xharness android test ^
    --app=..\test\Sentry.Maui.Device.TestApp\bin\Debug\net6.0-android\io.sentry.dotnet.maui.device.testapp-Signed.apk ^
    --package-name=io.sentry.dotnet.maui.device.testapp ^
    --output-directory=..\test_output

:end
popd
